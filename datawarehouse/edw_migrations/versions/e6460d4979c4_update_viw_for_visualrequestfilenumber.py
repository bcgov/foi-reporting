"""update_viw_for_visualrequestfilenumber

Revision ID: e6460d4979c4
Revises: d5ebe8047a56
Create Date: 2022-04-13 13:15:17.546585

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = 'e6460d4979c4'
down_revision = 'd5ebe8047a56'
branch_labels = None
depends_on = None


def upgrade():
    op.execute('DROP VIEW public.viw_sampletlreport; CREATE OR REPLACE VIEW public.viw_sampletlreport AS SELECT rd.visualrequestfilenumber AS "Request ID", rt.requesttypename AS "Request Type", category.requestertypename AS "Applicant Category", rd.redactiondescription AS "Request Description", rd.startdate AS "Start Date", rd.targetdate AS "Due Date", rd.remainingdays AS "Remaining Days", rd.currentactivity AS "Current Action", rd.requeststatus AS "Request Status", rd.primaryusername AS "Primary User", rd.execcomments AS "Comments", rd.extension AS "# of Extensions Applied", lastinvoice.invoiceddate AS "Last Invoice Date", rdd.noofpagesintherequest AS "Total # of pages in a request", eco.officedescription AS "Office Name", eco.officecode AS "Office Code", rd.caseowner AS "Request Owner", (req.lastname::text || \', \'::text) || req.firstname::text AS "Applicant Name", rd.groupname AS "User Group", rd.requesteddate AS "Requested Date", rd.receiveddate AS "Received Date", rd.closeddate AS "Closed Date", rd.originalcloseddate AS "Original Closed Date", rd.requestage AS "Request Age" FROM "factRequestDetails" rd LEFT JOIN "dimRequests" r ON rd.foirequestid = r.foirequestid LEFT JOIN "dimRequestTypes" rt ON rt.requesttypeid = rd.requesttypeid LEFT JOIN "dimRequesterTypes" category ON rd.applicantcategoryid = category.requestertypeid LEFT JOIN ( SELECT DISTINCT ON ("factRequestInvoices".foirequestid) "factRequestInvoices".foirequestid, "factRequestInvoices".invoiceddate FROM "factRequestInvoices" WHERE "factRequestInvoices".activeflag = \'Y\' ORDER BY "factRequestInvoices".foirequestid, "factRequestInvoices".createddate DESC) lastinvoice ON lastinvoice.foirequestid = rd.foirequestid LEFT JOIN "factRequestDocumentsDetails" rdd ON rdd.foirequestid = rd.foirequestid and rdd.activeflag = \'Y\' LEFT JOIN "dimECOffice" eco ON eco.officeid = rd.officeid LEFT JOIN "factRequestRequesters" rr ON rd.foirequestid = rr.foirequestid and rr.activeflag = \'Y\' LEFT JOIN "dimRequesters" req ON rr.requesterid = req.requesterid WHERE rd.activeflag = \'Y\'; commit;')
    op.execute('DROP VIEW public.viw_scanningreport; CREATE OR REPLACE VIEW public.viw_scanningreport AS SELECT rd.visualrequestfilenumber AS "Request ID",    rd.extension AS "# of Extensions Applied",    frccf.physicalpageestimate AS "Physical Page Estimate",    frccf.electronicpageestimate AS "Electronic Page Estimate",    rd.remainingdays AS "Remaining Days",    rd.targetdate AS "Due Date",    rd.primaryusername AS "Primary User"   FROM "factRequestDetails" rd     LEFT JOIN "dimRequests" r ON rd.foirequestid = r.foirequestid     LEFT JOIN "factRequestDocumentsDetails" rdd ON rdd.foirequestid = rd.foirequestid AND rdd.activeflag = \'Y\'::bpchar 	 LEFT JOIN public."factRequestCustomCalcFields" frccf on rd.foirequestid = frccf.foirequestid  WHERE rd.activeflag = \'Y\'::bpchar;ALTER TABLE public.viw_scanningreport    OWNER TO postgres;GRANT ALL ON TABLE public.viw_scanningreport TO postgres;GRANT SELECT ON TABLE public.viw_scanningreport TO redash_role;')
    op.execute('DROP VIEW public.viw_cfrrfdreport; CREATE OR REPLACE VIEW public.viw_cfrrfdreport AS SELECT rd.visualrequestfilenumber AS "Request ID",    rd.redactiondescription AS "Request Description",    rfd.createddate AS "Request Start Date",    eco2.officedescription AS "Office of Primary Interest",    rfd.completeddate AS "Completed Date",    rfds.reqfordocstatus AS "RFD Status",    rd.status AS "Request Status",    rd.primaryusername AS "Primary User",    rfd.requestdescription AS "RFD Comments",    frfdcf.rfdage AS "RFD Age",    rd.requestage AS "Request Age",    rfd.duedate AS "Due Date",    rfd.createddate AS "Requested Date",    frfdcf.remainingdays AS "Remaining Days",    frfdcf.elapseddays AS "Processed Days",    rt.requesttypename AS "Request Type",    eco.officedescription AS "Office Name",    eco.officecode AS "Office Code"   FROM "factRequestForDocuments" rfd     LEFT JOIN "dimRequests" r ON rfd.foirequestid = r.foirequestid     LEFT JOIN "factRequestDetails" rd ON r.foirequestid = rd.foirequestid AND rd.activeflag = \'Y\'::bpchar     LEFT JOIN "dimRequestForDocumentsStatus" rfds ON rfd.reqfordocstatusid = rfds.reqfordocstatusid     LEFT JOIN "dimRequestTypes" rt ON rt.requesttypeid = rfd.requesttypeid     LEFT JOIN "dimECOffice" eco ON eco.officeid = rfd.officeid     LEFT JOIN "dimECOffice" eco2 ON eco2.officeid = rfd.programofficeid 	 LEFT JOIN "factRequestRFDCalculatedFields" frfdcf ON rfd.foirequestid = frfdcf.foirequestid and rfd.actionid = frfdcf.actionid  WHERE rfd.activeflag = \'Y\'::bpchar;ALTER TABLE public.viw_cfrrfdreport    OWNER TO postgres;GRANT ALL ON TABLE public.viw_cfrrfdreport TO postgres;GRANT SELECT ON TABLE public.viw_cfrrfdreport TO redash_role;')
    op.execute('DROP VIEW public.viw_broaderaxisfields; CREATE OR REPLACE VIEW public.viw_broaderaxisfields AS SELECT rd.visualrequestfilenumber AS "Request ID",    re.extensiondays AS "# of days extended",    frccf.noofdocdelivered AS "# of documents delivered",    frccf.noofpagesreleased AS "# of pages released",    frccf.noofpagesreviewed AS "# of pages reviewed",    eco.officecode AS "Action Office",    rd.amendmentcreateddate AS "Amended Date",    rpt.estimatedamount AS "Amount Estimated ($)",    rpt.paidamount AS "Amount Paid ($)",    (((((((((abill.address1::text || \', \'::text) || abill.address2::text) || \', \'::text) || abill.city::text) || \', \'::text) || abill.state::text) || \', \'::text) || abill.country::text) || \', \'::text) || abill.zipcode::text AS "Applicant Billing Address",    rqstrt.requestertypename AS "Applicant Category",    rqstr.email AS "Applicant Email",    rqstr.fax AS "Applicant Fax",    rpt.applicationfee AS "Application Fee ($)",    rd.refvisualrequestfilenumber AS "Applicant\'s File Reference",    rqstr.home AS "Applicant Home Phone",    rqstr.mobile AS "Applicant Mobile",    rqstr.fullname AS "Applicant Name",    (((((((((aship.address1::text || \', \'::text) || aship.address2::text) || \', \'::text) || aship.city::text) || \', \'::text) || aship.state::text) || \', \'::text) || aship.country::text) || \', \'::text) || aship.zipcode::text AS "Applicant Shipping Address",    rqstr.workphone1 AS "Applicant Work Phone1",    rqstr.workphone2 AS "Applicant Work Phone2",    rpt.invoicedamount - rpt.paidamount AS "Balance Amount ($)",    COALESCE(( SELECT sum(COALESCE(ri.chargedamount, 0::numeric)) AS sum           FROM "factRequestInvoices" ri          WHERE ri.activeflag = \'Y\'::bpchar AND rd.activeflag = \'Y\'::bpchar AND rd.foirequestid = ri.foirequestid AND ri.invoicenumber <> \'0\'::bpchar          GROUP BY ri.foirequestid), 0::numeric) AS "Charged Amount ($)",    rd.closedby AS "Closed By",    rd.closeddate AS "Closed Date",    rd.notes AS "Comments",    frccf.coordinatednrresponsereqd AS "Coordinated NR Response Req\'d",    rd.receivedbyusername AS "Created By",    rd.createddate AS "Created Date",    rd.currentactivity AS "Current Action",    rd.deliverydate AS "Delivery Date",    dm.deliverymodename AS "Delivery Mode",    rd.targetdate AS "Due Date",    re.approveddate AS "Extension Approval/Denial Date",    re.approvedcomments AS "Extension Approval/Denial Note",    re.completeddate AS "Extension Completed Date",    re.completedcomments AS "Extension Completion Note",    re.comments AS "Extension Note",    et.extensiontypename AS "Extension Reason",        CASE            WHEN re.cstatus = \'C\'::bpchar AND re.approvedstatus = \'A\'::bpchar THEN \'Completed (Approved)\'::text            WHEN re.cstatus = \'P\'::bpchar AND re.approvedstatus = \'N\'::bpchar THEN \'Pending\'::text            WHEN re.cstatus = \'A\'::bpchar AND re.approvedstatus = \'A\'::bpchar THEN \'Approved\'::text            WHEN re.cstatus = \'D\'::bpchar AND re.approvedstatus = \'D\'::bpchar THEN \'Denied\'::text            WHEN re.cstatus = \'C\'::bpchar AND re.approvedstatus = \'D\'::bpchar THEN \'Completed (Denied)\'::text            ELSE NULL::text        END AS "Extension Status",    rpt.feewaivedescription AS "Fee Waiver Request Reason",    rpt.feewaiverequested AS "Fee Waiver Requested",    rpt.feewaivegranted AS "Fee Waiver Status",    rd.disposition AS "Final Disposition",    rpt.invoicedamount AS "Last Invoice Amount ($)",    rpt.invoicedate AS "Last Invoice Date",    rpt.invoicenumber AS "Last Invoice Number",    frccf.applicantfilereference AS "Link Requests",    pm.paymentmodename AS "Method of Payment",    frccf.noofpagesdeduplicated AS "Number of Pages Deduplicated",    onbehalfofrequesterid.fullname AS "On Behalf Of",    rqstr.company AS "Organization",    rd.originalcloseddate AS "Original Closed Date",    rd.originaltargetdate AS "Original Due Date",    rd.originalreceiveddate AS "Original Start Date",    rpt.paymentreceiveddate AS "Payment Date",    rpt.paymentstatus AS "Payment Status",    rd.primaryusername AS "Primary User",    ecg.groupname AS "Primary User Group",    rd.processeddays AS "Processed Days",    rd.receiveddate AS "Received Date",    rm.receivedmodename AS "Received Mode",    rd.referencenumber AS "Reference Number",    frccf.refundamount AS "Refund Amount",    rd.remainingdays AS "Remaining Days",    rd.requestdescription AS "Request Description",    rd.caseowner AS "Request Owner",    rd.status AS "Request Status",    rt.requesttypename AS "Request Type",    frccf.secondaryusers AS "Secondary Users",    rd.startdate AS "Start Date",    frccf.subject AS "Subject",    rdd.noofpagesintherequest AS "Total # of pages in a request",    rdd.noofpagesinreviewlog AS "Total # of pages in the review log",    frccf.onholddays AS "Total Days on Hold",    rpt.totalinvoicedamount AS "Total Invoiced ($)",    frccf.crossgovtno AS "XGOV"   FROM "factRequestDetails" rd     LEFT JOIN "dimRequests" r ON rd.foirequestid = r.foirequestid     LEFT JOIN "dimECOffice" eco ON rd.officeid = eco.officeid     LEFT JOIN "dimAddress" aship ON rd.shipaddressid = aship.addressid     LEFT JOIN "dimAddress" abill ON rd.billaddressid = abill.addressid     LEFT JOIN "factRequestExtensions" re ON r.foirequestid = re.foirequestid AND re.activeflag = \'Y\'::bpchar     LEFT JOIN "dimExtensionTypes" et ON re.extensiontypeid = et.extensiontypeid     LEFT JOIN "factRequestRequesters" rr ON r.foirequestid = rr.foirequestid AND rr.activeflag = \'Y\'::bpchar     LEFT JOIN "dimRequesters" rqstr ON rr.requesterid = rqstr.requesterid     LEFT JOIN "dimReceivedModes" rm ON rd.receivedmodeid = rm.receivedmodeid     LEFT JOIN "dimDeliveryModes" dm ON rd.deliverymodeid = dm.deliverymodeid     LEFT JOIN "dimECGroups" ecg ON rd.primarygroupid = ecg.groupid     LEFT JOIN "dimRequestTypes" rt ON rd.requesttypeid = rt.requesttypeid     LEFT JOIN "factRequestDocumentsDetails" rdd ON r.foirequestid = rdd.foirequestid AND rdd.activeflag = \'Y\'::bpchar     LEFT JOIN "factRequestPaymentTransaction" rpt ON r.foirequestid = rpt.foirequestid AND rpt.activeflag = \'Y\'::bpchar     LEFT JOIN "dimPaymentModes" pm ON rpt.paymentmodeid = pm.paymentmodeid     LEFT JOIN "dimRequesters" onbehalfofrequesterid ON rd.onbehalfofrequesterid = onbehalfofrequesterid.requesterid     LEFT JOIN "dimRequesterTypes" rqstrt ON rd.applicantcategoryid = rqstrt.requestertypeid 	 LEFT JOIN public."factRequestCustomCalcFields" frccf on rd.foirequestid = frccf.foirequestid  WHERE rd.activeflag = \'Y\'::bpchar;ALTER TABLE public.viw_broaderaxisfields    OWNER TO postgres;GRANT ALL ON TABLE public.viw_broaderaxisfields TO postgres;GRANT SELECT ON TABLE public.viw_broaderaxisfields TO redash_role;		')
    op.execute('DROP VIEW public.viw_activeoipcreviews; CREATE OR REPLACE VIEW public.viw_activeoipcreviews AS SELECT rd.visualrequestfilenumber AS "Request ID", frccf.oipcno AS "OIPC No", rd.primaryusername AS "Primary User", rd.startdate AS "Start Date", rd.targetdate AS "Due Date", frccf.reviewtype AS "Review Type",     frccf.customfieldstatus AS "Status",     frccf.reason AS "Reason",     rd.requestdescription AS "Request Description",    frccf.subject AS "Subject",     rqt.requestertypename AS "Applicant Type",    frccf.portfolioofficer AS "Portfolio Officer",     frccf.judicialreview AS "Judicial Review",     rd.status AS "Request Status",    rs.requeststatusname AS "Request Status Name",    eco.officecode AS procorg   FROM "factRequestDetails" rd     LEFT JOIN "dimRequests" r ON rd.foirequestid = r.foirequestid     LEFT JOIN "dimRequesterTypes" rqt ON rd.applicantcategoryid = rqt.requestertypeid     LEFT JOIN "dimRequestStatuses" rs ON rd.requeststatusid = rs.requeststatusid     LEFT JOIN "dimECOffice" eco ON rd.officeid = eco.officeid 	 LEFT JOIN public."factRequestCustomCalcFields" frccf on rd.foirequestid = frccf.foirequestid  WHERE rd.requesttypeid = (( SELECT rt.requesttypeid           FROM "dimRequestTypes" rt          WHERE rt.requesttypename::text = \'Review\'::text)) AND rd.activeflag = \'Y\'::bpchar; ALTER TABLE public.viw_activeoipcreviews OWNER TO postgres; GRANT ALL ON TABLE public.viw_activeoipcreviews TO postgres; GRANT SELECT ON TABLE public.viw_activeoipcreviews TO redash_role;')
    op.execute('DROP VIEW public.viw_analystworkloaddash; CREATE OR REPLACE VIEW public.viw_analystworkloaddash AS  SELECT r.foirequestid,    rd.visualrequestfilenumber AS requestid,        CASE            WHEN ecg.groupname::text = \'Consolidated Intake\'::text THEN \'Intake\'::character varying            ELSE ecggn.groupname        END AS team,        CASE            WHEN ecg.groupname::text = \'Consolidated Intake\'::text THEN ecg.groupdescription            ELSE ecggn.groupdescription        END AS manager,    rd.ministry,    eco.officecode AS procorg,    rd.applicantcategoryid AS category,    rt.requesttypename AS type,    rqt.requestertypename AS applicanttype,    (req.lastname::text || \', \'::text) || req.firstname::text AS applicantname,    frccf.subject,    rd.startdate,    rd.closeddate AS enddate,    rd.targetdate AS duedate,    rd.processeddays AS totalprocesseddays,    rd.currentactivity,    frccf.currentactivitydate,    rd.primaryusername AS analyst,    frccf.crossgovtno,    rd.requestdescription AS description,    rd.status,	frccf.customfieldstatus as "Custom Status",    frccf.countontime,    frccf.countoverdue,    frccf.onholddays,    frccf.daysoverdue,        CASE            WHEN rd.requeststatus::text = \'Closed\'::text THEN \'Closed\'::text            ELSE \'Not Closed\'::text        END AS notclosed,    rpt.estimatedamount AS feesest,    rpt.incurredamount AS feeswaived,    rpt.paidamount AS feespaid,    rd.disposition,    frccf.publication,    frccf.publicationreason,        CASE            WHEN rd.extension IS NULL THEN \'N\'::text            ELSE \'Y\'::text        END AS extension,    rd.execcomments,    frccf.noofpagesreleased AS noofpagesdelivered,    rdd.noofpagesintherequest,        CASE            WHEN EXTRACT(month FROM rd.receiveddate) >= 4::numeric AND EXTRACT(month FROM rd.receiveddate) <= 12::numeric THEN COALESCE(EXTRACT(year FROM rd.receiveddate)::text, \'\'::text) || COALESCE(EXTRACT(year FROM rd.receiveddate + \'1 year\'::interval)::text, \'\'::text)            WHEN EXTRACT(month FROM rd.receiveddate) IS NULL THEN \'\'::text            ELSE COALESCE(EXTRACT(year FROM rd.receiveddate + \'-1 years\'::interval)::text, \'\'::text) || COALESCE(EXTRACT(year FROM rd.receiveddate)::text, \'\'::text)        END AS startfyr,        CASE            WHEN EXTRACT(month FROM rd.closeddate) >= 4::numeric AND EXTRACT(month FROM rd.closeddate) <= 12::numeric THEN COALESCE(EXTRACT(year FROM rd.closeddate)::text, \'\'::text) || COALESCE(EXTRACT(year FROM rd.closeddate + \'1 year\'::interval)::text, \'\'::text)            WHEN EXTRACT(month FROM rd.closeddate) IS NULL THEN \'\'::text            ELSE COALESCE(EXTRACT(year FROM rd.closeddate + \'-1 years\'::interval)::text, \'\'::text) || COALESCE(EXTRACT(year FROM rd.closeddate)::text, \'\'::text)        END AS endfyr,        CASE            WHEN EXTRACT(month FROM rd.receiveddate) >= 4::numeric AND EXTRACT(month FROM rd.receiveddate) <= 6::numeric THEN 1            WHEN EXTRACT(month FROM rd.receiveddate) >= 7::numeric AND EXTRACT(month FROM rd.receiveddate) <= 9::numeric THEN 2            WHEN EXTRACT(month FROM rd.receiveddate) >= 10::numeric AND EXTRACT(month FROM rd.receiveddate) <= 12::numeric THEN 3            WHEN EXTRACT(month FROM rd.receiveddate) >= 1::numeric AND EXTRACT(month FROM rd.receiveddate) <= 3::numeric THEN 4            ELSE NULL::integer        END AS startfqtr,        CASE            WHEN EXTRACT(month FROM rd.closeddate) >= 4::numeric AND EXTRACT(month FROM rd.closeddate) <= 6::numeric THEN 1            WHEN EXTRACT(month FROM rd.closeddate) >= 7::numeric AND EXTRACT(month FROM rd.closeddate) <= 9::numeric THEN 2            WHEN EXTRACT(month FROM rd.closeddate) >= 10::numeric AND EXTRACT(month FROM rd.closeddate) <= 12::numeric THEN 3            WHEN EXTRACT(month FROM rd.closeddate) >= 1::numeric AND EXTRACT(month FROM rd.closeddate) <= 3::numeric THEN 4            ELSE NULL::integer        END AS endfqtr   FROM "factRequestDetails" rd     LEFT JOIN "dimRequests" r ON rd.foirequestid = r.foirequestid     LEFT JOIN "dimECGroups" ecg ON rd.primarygroupid = ecg.groupid     LEFT JOIN "dimECGroups" ecggn ON rd.groupname::text = ecggn.groupname::text     LEFT JOIN "dimECOffice" eco ON rd.officeid = eco.officeid     LEFT JOIN "dimRequestTypes" rt ON rd.requesttypeid = rt.requesttypeid     LEFT JOIN "dimRequesterTypes" rqt ON rd.applicantcategoryid = rqt.requestertypeid     LEFT JOIN "factRequestPaymentTransaction" rpt ON r.foirequestid = rpt.foirequestid AND rpt.activeflag = \'Y\'::bpchar     LEFT JOIN "factRequestDocumentsDetails" rdd ON r.foirequestid = rdd.foirequestid AND rdd.activeflag = \'Y\'::bpchar     LEFT JOIN "factRequestRequesters" rr ON r.foirequestid = rr.foirequestid AND rr.activeflag = \'Y\'::bpchar     LEFT JOIN "dimRequesters" req ON rr.requesterid = req.requesterid 	 LEFT JOIN "factRequestCustomCalcFields" frccf ON rd.foirequestid = frccf.foirequestid  WHERE rd.activeflag = \'Y\'::bpchar AND (eco.officecode::text <> ALL (ARRAY[\'IMB\'::character varying, \'IAO\'::character varying, \'XGR\'::character varying]::text[])) AND (rt.requesttypename::text = ANY (ARRAY[\'Consultation\'::character varying, \'Correction\'::character varying, \'General\'::character varying, \'Other\'::character varying, \'Personal\'::character varying, \'Review\'::character varying]::text[]));ALTER TABLE public.viw_analystworkloaddash    OWNER TO postgres;GRANT ALL ON TABLE public.viw_analystworkloaddash TO postgres;GRANT SELECT ON TABLE public.viw_analystworkloaddash TO redash_role;')
    op.execute('DROP VIEW public.viw_oipc_10_1dreport; CREATE OR REPLACE VIEW public.viw_oipc_10_1dreport AS SELECT rd.visualrequestfilenumber AS "Request ID", rd.targetdate AS "Due Date", re.extendeddate AS "Proposed Date", rd.primaryusername AS "Primary User" FROM "factRequestDetails" rd LEFT JOIN "dimRequests" r ON rd.foirequestid = r.foirequestid JOIN "factRequestExtensions" re ON re.foirequestid = rd.foirequestid and re.activeflag = \'Y\' LEFT JOIN "dimExtensionTypes" et ON et.extensiontypeid = re.extensiontypeid WHERE rd.activeflag = \'Y\' and et.extensiontypename::text !~~ \'PB%\'::text AND re.cstatus = \'P\'::bpchar ORDER BY rd.visualrequestfilenumber;')
    op.execute('DROP VIEW public.viw_additionalfields;CREATE OR REPLACE VIEW public.viw_additionalfields AS '\
'SELECT rd.visualrequestfilenumber AS "Request ID", '\
'frccf.identityverification,'\
'frccf.previousfoirequest,'\
'frccf.physicalpageestimate,'\
'frccf.electronicpageestimate,'\
'frccf.noofpagesdeduplicated,'\
'frccf.applicationfeepaid,'\
'frccf.applicationfeerefunded ,'\
'frccf.applicationfeetransferred,'\
'frccf.linkedrequests,'\
'eco.officecode AS "Action Office",'\
'rd.closeddate AS "Closed Date",'\
'rd.targetdate AS "Due Date"'\
' FROM "factRequestDetails" rd '\
     'LEFT JOIN "dimRequests" r ON rd.foirequestid = r.foirequestid '\
     'LEFT JOIN "dimECOffice" eco ON rd.officeid = eco.officeid '\
     'LEFT JOIN "factRequestDocumentsDetails" rdd ON r.foirequestid = rdd.foirequestid AND rdd.activeflag = \'Y\'::bpchar '\
     
     'LEFT JOIN "factRequestCustomCalcFields" frccf ON rd.foirequestid = frccf.foirequestid '\
 ' WHERE rd.activeflag = \'Y\'::bpchar; ALTER TABLE public.viw_additionalfields    OWNER TO postgres;GRANT ALL ON TABLE public.viw_additionalfields TO postgres;GRANT SELECT ON TABLE public.viw_additionalfields TO redash_role; ')

def downgrade():
    op.execute('DROP VIEW public.viw_sampletlreport; CREATE OR REPLACE VIEW public.viw_sampletlreport AS SELECT r.visualrequestfilenumber AS "Request ID", rt.requesttypename AS "Request Type", category.requestertypename AS "Applicant Category", rd.redactiondescription AS "Request Description", rd.startdate AS "Start Date", rd.targetdate AS "Due Date", rd.remainingdays AS "Remaining Days", rd.currentactivity AS "Current Action", rd.requeststatus AS "Request Status", rd.primaryusername AS "Primary User", rd.execcomments AS "Comments", rd.extension AS "# of Extensions Applied", lastinvoice.invoiceddate AS "Last Invoice Date", rdd.noofpagesintherequest AS "Total # of pages in a request", eco.officedescription AS "Office Name", eco.officecode AS "Office Code", rd.caseowner AS "Request Owner", (req.lastname::text || \', \'::text) || req.firstname::text AS "Applicant Name", rd.groupname AS "User Group", rd.requesteddate AS "Requested Date", rd.receiveddate AS "Received Date", rd.closeddate AS "Closed Date", rd.originalcloseddate AS "Original Closed Date", rd.requestage AS "Request Age" FROM "factRequestDetails" rd LEFT JOIN "dimRequests" r ON rd.foirequestid = r.foirequestid LEFT JOIN "dimRequestTypes" rt ON rt.requesttypeid = rd.requesttypeid LEFT JOIN "dimRequesterTypes" category ON rd.applicantcategoryid = category.requestertypeid LEFT JOIN ( SELECT DISTINCT ON ("factRequestInvoices".foirequestid) "factRequestInvoices".foirequestid, "factRequestInvoices".invoiceddate FROM "factRequestInvoices" WHERE "factRequestInvoices".activeflag = \'Y\' ORDER BY "factRequestInvoices".foirequestid, "factRequestInvoices".createddate DESC) lastinvoice ON lastinvoice.foirequestid = rd.foirequestid LEFT JOIN "factRequestDocumentsDetails" rdd ON rdd.foirequestid = rd.foirequestid and rdd.activeflag = \'Y\' LEFT JOIN "dimECOffice" eco ON eco.officeid = rd.officeid LEFT JOIN "factRequestRequesters" rr ON rd.foirequestid = rr.foirequestid and rr.activeflag = \'Y\' LEFT JOIN "dimRequesters" req ON rr.requesterid = req.requesterid WHERE rd.activeflag = \'Y\'; commit;')
    op.execute('DROP VIEW public.viw_scanningreport; CREATE OR REPLACE VIEW public.viw_scanningreport AS SELECT r.visualrequestfilenumber AS "Request ID",    rd.extension AS "# of Extensions Applied",    frccf.physicalpageestimate AS "Physical Page Estimate",    frccf.electronicpageestimate AS "Electronic Page Estimate",    rd.remainingdays AS "Remaining Days",    rd.targetdate AS "Due Date",    rd.primaryusername AS "Primary User"   FROM "factRequestDetails" rd     LEFT JOIN "dimRequests" r ON rd.foirequestid = r.foirequestid     LEFT JOIN "factRequestDocumentsDetails" rdd ON rdd.foirequestid = rd.foirequestid AND rdd.activeflag = \'Y\'::bpchar 	 LEFT JOIN public."factRequestCustomCalcFields" frccf on rd.foirequestid = frccf.foirequestid  WHERE rd.activeflag = \'Y\'::bpchar;ALTER TABLE public.viw_scanningreport    OWNER TO postgres;GRANT ALL ON TABLE public.viw_scanningreport TO postgres;GRANT SELECT ON TABLE public.viw_scanningreport TO redash_role;')
    op.execute('DROP VIEW public.viw_cfrrfdreport; CREATE OR REPLACE VIEW public.viw_cfrrfdreport AS SELECT r.visualrequestfilenumber AS "Request ID",    rd.redactiondescription AS "Request Description",    rfd.createddate AS "Request Start Date",    eco2.officedescription AS "Office of Primary Interest",    rfd.completeddate AS "Completed Date",    rfds.reqfordocstatus AS "RFD Status",    rd.status AS "Request Status",    rd.primaryusername AS "Primary User",    rfd.requestdescription AS "RFD Comments",    frfdcf.rfdage AS "RFD Age",    rd.requestage AS "Request Age",    rfd.duedate AS "Due Date",    rfd.createddate AS "Requested Date",    frfdcf.remainingdays AS "Remaining Days",    frfdcf.elapseddays AS "Processed Days",    rt.requesttypename AS "Request Type",    eco.officedescription AS "Office Name",    eco.officecode AS "Office Code"   FROM "factRequestForDocuments" rfd     LEFT JOIN "dimRequests" r ON rfd.foirequestid = r.foirequestid     LEFT JOIN "factRequestDetails" rd ON r.foirequestid = rd.foirequestid AND rd.activeflag = \'Y\'::bpchar     LEFT JOIN "dimRequestForDocumentsStatus" rfds ON rfd.reqfordocstatusid = rfds.reqfordocstatusid     LEFT JOIN "dimRequestTypes" rt ON rt.requesttypeid = rfd.requesttypeid     LEFT JOIN "dimECOffice" eco ON eco.officeid = rfd.officeid     LEFT JOIN "dimECOffice" eco2 ON eco2.officeid = rfd.programofficeid 	 LEFT JOIN "factRequestRFDCalculatedFields" frfdcf ON rfd.foirequestid = frfdcf.foirequestid and rfd.actionid = frfdcf.actionid  WHERE rfd.activeflag = \'Y\'::bpchar;ALTER TABLE public.viw_cfrrfdreport    OWNER TO postgres;GRANT ALL ON TABLE public.viw_cfrrfdreport TO postgres;GRANT SELECT ON TABLE public.viw_cfrrfdreport TO redash_role;')
    op.execute('DROP VIEW public.viw_broaderaxisfields; CREATE OR REPLACE VIEW public.viw_broaderaxisfields AS SELECT r.visualrequestfilenumber AS "Request ID",    re.extensiondays AS "# of days extended",    frccf.noofdocdelivered AS "# of documents delivered",    frccf.noofpagesreleased AS "# of pages released",    frccf.noofpagesreviewed AS "# of pages reviewed",    eco.officecode AS "Action Office",    rd.amendmentcreateddate AS "Amended Date",    rpt.estimatedamount AS "Amount Estimated ($)",    rpt.paidamount AS "Amount Paid ($)",    (((((((((abill.address1::text || \', \'::text) || abill.address2::text) || \', \'::text) || abill.city::text) || \', \'::text) || abill.state::text) || \', \'::text) || abill.country::text) || \', \'::text) || abill.zipcode::text AS "Applicant Billing Address",    rqstrt.requestertypename AS "Applicant Category",    rqstr.email AS "Applicant Email",    rqstr.fax AS "Applicant Fax",    rpt.applicationfee AS "Application Fee ($)",    rd.refvisualrequestfilenumber AS "Applicant\'s File Reference",    rqstr.home AS "Applicant Home Phone",    rqstr.mobile AS "Applicant Mobile",    rqstr.fullname AS "Applicant Name",    (((((((((aship.address1::text || \', \'::text) || aship.address2::text) || \', \'::text) || aship.city::text) || \', \'::text) || aship.state::text) || \', \'::text) || aship.country::text) || \', \'::text) || aship.zipcode::text AS "Applicant Shipping Address",    rqstr.workphone1 AS "Applicant Work Phone1",    rqstr.workphone2 AS "Applicant Work Phone2",    rpt.invoicedamount - rpt.paidamount AS "Balance Amount ($)",    COALESCE(( SELECT sum(COALESCE(ri.chargedamount, 0::numeric)) AS sum           FROM "factRequestInvoices" ri          WHERE ri.activeflag = \'Y\'::bpchar AND rd.activeflag = \'Y\'::bpchar AND rd.foirequestid = ri.foirequestid AND ri.invoicenumber <> \'0\'::bpchar          GROUP BY ri.foirequestid), 0::numeric) AS "Charged Amount ($)",    rd.closedby AS "Closed By",    rd.closeddate AS "Closed Date",    rd.notes AS "Comments",    frccf.coordinatednrresponsereqd AS "Coordinated NR Response Req\'d",    rd.receivedbyusername AS "Created By",    rd.createddate AS "Created Date",    rd.currentactivity AS "Current Action",    rd.deliverydate AS "Delivery Date",    dm.deliverymodename AS "Delivery Mode",    rd.targetdate AS "Due Date",    re.approveddate AS "Extension Approval/Denial Date",    re.approvedcomments AS "Extension Approval/Denial Note",    re.completeddate AS "Extension Completed Date",    re.completedcomments AS "Extension Completion Note",    re.comments AS "Extension Note",    et.extensiontypename AS "Extension Reason",        CASE            WHEN re.cstatus = \'C\'::bpchar AND re.approvedstatus = \'A\'::bpchar THEN \'Completed (Approved)\'::text            WHEN re.cstatus = \'P\'::bpchar AND re.approvedstatus = \'N\'::bpchar THEN \'Pending\'::text            WHEN re.cstatus = \'A\'::bpchar AND re.approvedstatus = \'A\'::bpchar THEN \'Approved\'::text            WHEN re.cstatus = \'D\'::bpchar AND re.approvedstatus = \'D\'::bpchar THEN \'Denied\'::text            WHEN re.cstatus = \'C\'::bpchar AND re.approvedstatus = \'D\'::bpchar THEN \'Completed (Denied)\'::text            ELSE NULL::text        END AS "Extension Status",    rpt.feewaivedescription AS "Fee Waiver Request Reason",    rpt.feewaiverequested AS "Fee Waiver Requested",    rpt.feewaivegranted AS "Fee Waiver Status",    rd.disposition AS "Final Disposition",    rpt.invoicedamount AS "Last Invoice Amount ($)",    rpt.invoicedate AS "Last Invoice Date",    rpt.invoicenumber AS "Last Invoice Number",    frccf.applicantfilereference AS "Link Requests",    pm.paymentmodename AS "Method of Payment",    frccf.noofpagesdeduplicated AS "Number of Pages Deduplicated",    onbehalfofrequesterid.fullname AS "On Behalf Of",    rqstr.company AS "Organization",    rd.originalcloseddate AS "Original Closed Date",    rd.originaltargetdate AS "Original Due Date",    rd.originalreceiveddate AS "Original Start Date",    rpt.paymentreceiveddate AS "Payment Date",    rpt.paymentstatus AS "Payment Status",    rd.primaryusername AS "Primary User",    ecg.groupname AS "Primary User Group",    rd.processeddays AS "Processed Days",    rd.receiveddate AS "Received Date",    rm.receivedmodename AS "Received Mode",    rd.referencenumber AS "Reference Number",    frccf.refundamount AS "Refund Amount",    rd.remainingdays AS "Remaining Days",    rd.requestdescription AS "Request Description",    rd.caseowner AS "Request Owner",    rd.status AS "Request Status",    rt.requesttypename AS "Request Type",    frccf.secondaryusers AS "Secondary Users",    rd.startdate AS "Start Date",    frccf.subject AS "Subject",    rdd.noofpagesintherequest AS "Total # of pages in a request",    rdd.noofpagesinreviewlog AS "Total # of pages in the review log",    frccf.onholddays AS "Total Days on Hold",    rpt.totalinvoicedamount AS "Total Invoiced ($)",    frccf.crossgovtno AS "XGOV"   FROM "factRequestDetails" rd     LEFT JOIN "dimRequests" r ON rd.foirequestid = r.foirequestid     LEFT JOIN "dimECOffice" eco ON rd.officeid = eco.officeid     LEFT JOIN "dimAddress" aship ON rd.shipaddressid = aship.addressid     LEFT JOIN "dimAddress" abill ON rd.billaddressid = abill.addressid     LEFT JOIN "factRequestExtensions" re ON r.foirequestid = re.foirequestid AND re.activeflag = \'Y\'::bpchar     LEFT JOIN "dimExtensionTypes" et ON re.extensiontypeid = et.extensiontypeid     LEFT JOIN "factRequestRequesters" rr ON r.foirequestid = rr.foirequestid AND rr.activeflag = \'Y\'::bpchar     LEFT JOIN "dimRequesters" rqstr ON rr.requesterid = rqstr.requesterid     LEFT JOIN "dimReceivedModes" rm ON rd.receivedmodeid = rm.receivedmodeid     LEFT JOIN "dimDeliveryModes" dm ON rd.deliverymodeid = dm.deliverymodeid     LEFT JOIN "dimECGroups" ecg ON rd.primarygroupid = ecg.groupid     LEFT JOIN "dimRequestTypes" rt ON rd.requesttypeid = rt.requesttypeid     LEFT JOIN "factRequestDocumentsDetails" rdd ON r.foirequestid = rdd.foirequestid AND rdd.activeflag = \'Y\'::bpchar     LEFT JOIN "factRequestPaymentTransaction" rpt ON r.foirequestid = rpt.foirequestid AND rpt.activeflag = \'Y\'::bpchar     LEFT JOIN "dimPaymentModes" pm ON rpt.paymentmodeid = pm.paymentmodeid     LEFT JOIN "dimRequesters" onbehalfofrequesterid ON rd.onbehalfofrequesterid = onbehalfofrequesterid.requesterid     LEFT JOIN "dimRequesterTypes" rqstrt ON rd.applicantcategoryid = rqstrt.requestertypeid 	 LEFT JOIN public."factRequestCustomCalcFields" frccf on rd.foirequestid = frccf.foirequestid  WHERE rd.activeflag = \'Y\'::bpchar;ALTER TABLE public.viw_broaderaxisfields    OWNER TO postgres;GRANT ALL ON TABLE public.viw_broaderaxisfields TO postgres;GRANT SELECT ON TABLE public.viw_broaderaxisfields TO redash_role;		')
    op.execute('DROP VIEW public.viw_activeoipcreviews; CREATE OR REPLACE VIEW public.viw_activeoipcreviews AS SELECT r.visualrequestfilenumber AS "Request ID", frccf.oipcno AS "OIPC No", rd.primaryusername AS "Primary User", rd.startdate AS "Start Date", rd.targetdate AS "Due Date", frccf.reviewtype AS "Review Type",     frccf.customfieldstatus AS "Status",     frccf.reason AS "Reason",     rd.requestdescription AS "Request Description",    frccf.subject AS "Subject",     rqt.requestertypename AS "Applicant Type",    frccf.portfolioofficer AS "Portfolio Officer",     frccf.judicialreview AS "Judicial Review",     rd.status AS "Request Status",    rs.requeststatusname AS "Request Status Name",    eco.officecode AS procorg   FROM "factRequestDetails" rd     LEFT JOIN "dimRequests" r ON rd.foirequestid = r.foirequestid     LEFT JOIN "dimRequesterTypes" rqt ON rd.applicantcategoryid = rqt.requestertypeid     LEFT JOIN "dimRequestStatuses" rs ON rd.requeststatusid = rs.requeststatusid     LEFT JOIN "dimECOffice" eco ON rd.officeid = eco.officeid 	 LEFT JOIN public."factRequestCustomCalcFields" frccf on rd.foirequestid = frccf.foirequestid  WHERE rd.requesttypeid = (( SELECT rt.requesttypeid           FROM "dimRequestTypes" rt          WHERE rt.requesttypename::text = \'Review\'::text)) AND rd.activeflag = \'Y\'::bpchar; ALTER TABLE public.viw_activeoipcreviews OWNER TO postgres; GRANT ALL ON TABLE public.viw_activeoipcreviews TO postgres; GRANT SELECT ON TABLE public.viw_activeoipcreviews TO redash_role;')
    op.execute('DROP VIEW public.viw_analystworkloaddash; CREATE OR REPLACE VIEW public.viw_analystworkloaddash AS  SELECT r.foirequestid,    r.visualrequestfilenumber AS requestid,        CASE            WHEN ecg.groupname::text = \'Consolidated Intake\'::text THEN \'Intake\'::character varying            ELSE ecggn.groupname        END AS team,        CASE            WHEN ecg.groupname::text = \'Consolidated Intake\'::text THEN ecg.groupdescription            ELSE ecggn.groupdescription        END AS manager,    rd.ministry,    eco.officecode AS procorg,    rd.applicantcategoryid AS category,    rt.requesttypename AS type,    rqt.requestertypename AS applicanttype,    (req.lastname::text || \', \'::text) || req.firstname::text AS applicantname,    frccf.subject,    rd.startdate,    rd.closeddate AS enddate,    rd.targetdate AS duedate,    rd.processeddays AS totalprocesseddays,    rd.currentactivity,    frccf.currentactivitydate,    rd.primaryusername AS analyst,    frccf.crossgovtno,    rd.requestdescription AS description,    rd.status,	frccf.customfieldstatus as "Custom Status",    frccf.countontime,    frccf.countoverdue,    frccf.onholddays,    frccf.daysoverdue,        CASE            WHEN rd.requeststatus::text = \'Closed\'::text THEN \'Closed\'::text            ELSE \'Not Closed\'::text        END AS notclosed,    rpt.estimatedamount AS feesest,    rpt.incurredamount AS feeswaived,    rpt.paidamount AS feespaid,    rd.disposition,    frccf.publication,    frccf.publicationreason,        CASE            WHEN rd.extension IS NULL THEN \'N\'::text            ELSE \'Y\'::text        END AS extension,    rd.execcomments,    frccf.noofpagesreleased AS noofpagesdelivered,    rdd.noofpagesintherequest,        CASE            WHEN EXTRACT(month FROM rd.receiveddate) >= 4::numeric AND EXTRACT(month FROM rd.receiveddate) <= 12::numeric THEN COALESCE(EXTRACT(year FROM rd.receiveddate)::text, \'\'::text) || COALESCE(EXTRACT(year FROM rd.receiveddate + \'1 year\'::interval)::text, \'\'::text)            WHEN EXTRACT(month FROM rd.receiveddate) IS NULL THEN \'\'::text            ELSE COALESCE(EXTRACT(year FROM rd.receiveddate + \'-1 years\'::interval)::text, \'\'::text) || COALESCE(EXTRACT(year FROM rd.receiveddate)::text, \'\'::text)        END AS startfyr,        CASE            WHEN EXTRACT(month FROM rd.closeddate) >= 4::numeric AND EXTRACT(month FROM rd.closeddate) <= 12::numeric THEN COALESCE(EXTRACT(year FROM rd.closeddate)::text, \'\'::text) || COALESCE(EXTRACT(year FROM rd.closeddate + \'1 year\'::interval)::text, \'\'::text)            WHEN EXTRACT(month FROM rd.closeddate) IS NULL THEN \'\'::text            ELSE COALESCE(EXTRACT(year FROM rd.closeddate + \'-1 years\'::interval)::text, \'\'::text) || COALESCE(EXTRACT(year FROM rd.closeddate)::text, \'\'::text)        END AS endfyr,        CASE            WHEN EXTRACT(month FROM rd.receiveddate) >= 4::numeric AND EXTRACT(month FROM rd.receiveddate) <= 6::numeric THEN 1            WHEN EXTRACT(month FROM rd.receiveddate) >= 7::numeric AND EXTRACT(month FROM rd.receiveddate) <= 9::numeric THEN 2            WHEN EXTRACT(month FROM rd.receiveddate) >= 10::numeric AND EXTRACT(month FROM rd.receiveddate) <= 12::numeric THEN 3            WHEN EXTRACT(month FROM rd.receiveddate) >= 1::numeric AND EXTRACT(month FROM rd.receiveddate) <= 3::numeric THEN 4            ELSE NULL::integer        END AS startfqtr,        CASE            WHEN EXTRACT(month FROM rd.closeddate) >= 4::numeric AND EXTRACT(month FROM rd.closeddate) <= 6::numeric THEN 1            WHEN EXTRACT(month FROM rd.closeddate) >= 7::numeric AND EXTRACT(month FROM rd.closeddate) <= 9::numeric THEN 2            WHEN EXTRACT(month FROM rd.closeddate) >= 10::numeric AND EXTRACT(month FROM rd.closeddate) <= 12::numeric THEN 3            WHEN EXTRACT(month FROM rd.closeddate) >= 1::numeric AND EXTRACT(month FROM rd.closeddate) <= 3::numeric THEN 4            ELSE NULL::integer        END AS endfqtr   FROM "factRequestDetails" rd     LEFT JOIN "dimRequests" r ON rd.foirequestid = r.foirequestid     LEFT JOIN "dimECGroups" ecg ON rd.primarygroupid = ecg.groupid     LEFT JOIN "dimECGroups" ecggn ON rd.groupname::text = ecggn.groupname::text     LEFT JOIN "dimECOffice" eco ON rd.officeid = eco.officeid     LEFT JOIN "dimRequestTypes" rt ON rd.requesttypeid = rt.requesttypeid     LEFT JOIN "dimRequesterTypes" rqt ON rd.applicantcategoryid = rqt.requestertypeid     LEFT JOIN "factRequestPaymentTransaction" rpt ON r.foirequestid = rpt.foirequestid AND rpt.activeflag = \'Y\'::bpchar     LEFT JOIN "factRequestDocumentsDetails" rdd ON r.foirequestid = rdd.foirequestid AND rdd.activeflag = \'Y\'::bpchar     LEFT JOIN "factRequestRequesters" rr ON r.foirequestid = rr.foirequestid AND rr.activeflag = \'Y\'::bpchar     LEFT JOIN "dimRequesters" req ON rr.requesterid = req.requesterid 	 LEFT JOIN "factRequestCustomCalcFields" frccf ON rd.foirequestid = frccf.foirequestid  WHERE rd.activeflag = \'Y\'::bpchar AND (eco.officecode::text <> ALL (ARRAY[\'IMB\'::character varying, \'IAO\'::character varying, \'XGR\'::character varying]::text[])) AND (rt.requesttypename::text = ANY (ARRAY[\'Consultation\'::character varying, \'Correction\'::character varying, \'General\'::character varying, \'Other\'::character varying, \'Personal\'::character varying, \'Review\'::character varying]::text[]));ALTER TABLE public.viw_analystworkloaddash    OWNER TO postgres;GRANT ALL ON TABLE public.viw_analystworkloaddash TO postgres;GRANT SELECT ON TABLE public.viw_analystworkloaddash TO redash_role;')
    op.execute('DROP VIEW public.viw_oipc_10_1dreport; CREATE OR REPLACE VIEW public.viw_oipc_10_1dreport AS SELECT r.visualrequestfilenumber AS "Request ID", rd.targetdate AS "Due Date", re.extendeddate AS "Proposed Date", rd.primaryusername AS "Primary User" FROM "factRequestDetails" rd LEFT JOIN "dimRequests" r ON rd.foirequestid = r.foirequestid JOIN "factRequestExtensions" re ON re.foirequestid = rd.foirequestid and re.activeflag = \'Y\' LEFT JOIN "dimExtensionTypes" et ON et.extensiontypeid = re.extensiontypeid WHERE rd.activeflag = \'Y\' and et.extensiontypename::text !~~ \'PB%\'::text AND re.cstatus = \'P\'::bpchar ORDER BY r.visualrequestfilenumber;')
    op.execute('DROP VIEW public.viw_additionalfields;CREATE OR REPLACE VIEW public.viw_additionalfields AS '\
'SELECT r.visualrequestfilenumber AS "Request ID", '\
'frccf.identityverification,'\
'frccf.previousfoirequest,'\
'frccf.physicalpageestimate,'\
'frccf.electronicpageestimate,'\
'frccf.noofpagesdeduplicated,'\
'frccf.applicationfeepaid,'\
'frccf.applicationfeerefunded ,'\
'frccf.applicationfeetransferred,'\
'frccf.linkedrequests,'\
'eco.officecode AS "Action Office",'\
'rd.closeddate AS "Closed Date",'\
'rd.targetdate AS "Due Date"'\
' FROM "factRequestDetails" rd '\
     'LEFT JOIN "dimRequests" r ON rd.foirequestid = r.foirequestid '\
     'LEFT JOIN "dimECOffice" eco ON rd.officeid = eco.officeid '\
     'LEFT JOIN "factRequestDocumentsDetails" rdd ON r.foirequestid = rdd.foirequestid AND rdd.activeflag = \'Y\'::bpchar '\
     
     'LEFT JOIN "factRequestCustomCalcFields" frccf ON rd.foirequestid = frccf.foirequestid '\
 ' WHERE rd.activeflag = \'Y\'::bpchar; ALTER TABLE public.viw_additionalfields    OWNER TO postgres;GRANT ALL ON TABLE public.viw_additionalfields TO postgres;GRANT SELECT ON TABLE public.viw_additionalfields TO redash_role; ')